!function(f){function n(t){this.data=t,this.id=this.data.id,this.selected=!1,this.events=f({}),this.$editor=f(".layers-editor"),this.$viewportLayers=this.$editor.find(".viewport-layers"),this.$viewportLayer=null,this.$listLayer=this.$editor.find('.list-layer[data-id="'+this.id+'"]'),this.$layerSettings=this.$editor.find('.layer-settings[data-id="'+this.id+'"]'),this.init()}var s={panels:[],panelCounter:0,postsData:{},allowPanelImageResize:!0,init:function(){"single"===ga_js_vars.page?this.initSingleAccordionPage():"all"===ga_js_vars.page&&this.initAllAccordionsPage()},initSingleAccordionPage:function(){var i=this;this.initPanels(),-1!==parseInt(ga_js_vars.id,10)&&this.loadAccordionData(function(){f(".panels-container").attr("data-loaded","true")}),f("form").on("submit",function(t){t.preventDefault(),i.saveAccordion()}),f(".preview-accordion").on("click",function(t){t.preventDefault(),i.previewAccordion()}),f('.add-panel, .panel-type a[data-type="empty"]').on("click",function(t){t.preventDefault(),i.addEmptyPanel()}),f('.panel-type a[data-type="image"]').on("click",function(t){t.preventDefault(),i.addImagePanels()}),f('.panel-type a[data-type="posts"]').on("click",function(t){t.preventDefault(),i.addPostsPanels()}),f('.panel-type a[data-type="gallery"]').on("click",function(t){t.preventDefault(),i.addGalleryPanels()}),f('.panel-type a[data-type="flickr"]').on("click",function(t){t.preventDefault(),i.addFlickrPanels()}),f(".add-breakpoint").on("click",function(t){t.preventDefault(),i.addBreakpoint()}),f(".breakpoints").on("click",".breakpoint-setting-name a",function(t){t.preventDefault();var e=f(this).attr("data-type"),t=f(this).parents(".breakpoint").find(".breakpoint-settings");i.addBreakpointSetting(e,t)}),f(".breakpoints").on("click",".remove-breakpoint",function(t){f(this).parents(".breakpoint").remove()}),f(".breakpoints").on("click",".remove-breakpoint-setting",function(t){f(this).parents("tr").remove()}),f(".breakpoints").lightSortable({children:".breakpoint",placeholder:""}),f(".postbox .hndle, .postbox .handlediv").on("click",function(){var t=f(this).parent(".postbox");!0===t.hasClass("closed")?t.removeClass("closed"):t.addClass("closed")}),f(".sidebar-settings").on("mouseover","label",function(){i.showInfo(f(this))}),f(window).resize(function(){!0===i.allowPanelImageResize&&(i.resizePanelImages(),i.allowPanelImageResize=!1,setTimeout(function(){i.resizePanelImages(),i.allowPanelImageResize=!0},250))})},initAllAccordionsPage:function(){var e=this;f(".accordions-list").on("click",".preview-accordion",function(t){t.preventDefault(),e.previewAccordionAll(f(this))}),f(".accordions-list").on("click",".delete-accordion",function(t){t.preventDefault(),e.deleteAccordion(f(this))}),f(".accordions-list").on("click",".duplicate-accordion",function(t){t.preventDefault(),e.duplicateAccordion(f(this))}),f(".accordions-list").on("click",".export-accordion",function(t){t.preventDefault(),e.exportAccordion(f(this))}),f(".import-accordion").on("click",function(t){t.preventDefault(),a.open()}),f(".clear-all-cache").on("click",function(t){t.preventDefault(),f(".clear-cache-spinner").css({display:"inline-block",visibility:"visible"});t=f(this).attr("data-nonce");f.ajax({url:ga_js_vars.ajaxurl,type:"post",data:{action:"grid_accordion_clear_all_cache",nonce:t},complete:function(t){f(".clear-cache-spinner").css({display:"",visibility:""})}})}),f(".getting-started-close").click(function(t){t.preventDefault(),f(".getting-started-info").hide(),f.ajax({url:ga_js_vars.ajaxurl,type:"post",data:{action:"grid_accordion_getting_started_close",nonce:ga_js_vars.cp_nonce}})}),f(".custom-css-js-warning-close").click(function(t){t.preventDefault();var e=f('<div class="modal-overlay"></div><div class="modal-window-container">\t<div class="modal-window delete-accordion-dialog">\t\t<p class="dialog-question">'+ga_js_vars.remove_custom_css_js_warning+'</p>\t\t<div class="dialog-buttons">\t\t\t<a class="button dialog-ok" href="#">'+ga_js_vars.yes+'</a>\t\t\t<a class="button dialog-cancel" href="#">'+ga_js_vars.cancel+"</a>\t\t</div>\t</div></div>").appendTo("body");e.find(".dialog-ok").one("click",function(t){t.preventDefault(),f(".custom-css-js-warning").hide(),f.ajax({url:ga_js_vars.ajaxurl,type:"post",data:{action:"grid_accordion_close_custom_css_js_warning",nonce:ga_js_vars.cp_nonce}}),e.remove()}),e.find(".dialog-cancel").one("click",function(t){t.preventDefault(),e.remove()}),e.find(".modal-overlay").one("click",function(t){e.remove()})})},loadAccordionData:function(e){var n=this;f(".panel-spinner").css({display:"inline-block",visibility:"visible"}),f.ajax({url:ga_js_vars.ajaxurl,type:"get",data:{action:"grid_accordion_get_accordion_data",id:ga_js_vars.id,nonce:ga_js_vars.lad_nonce},complete:function(t){t=f.parseJSON(t.responseText);f.each(t.panels,function(t,e){var i={background:{},layers:e.layers,html:e.html,settings:f.isArray(e.settings)?{}:e.settings};f.each(e,function(t,e){-1!==t.indexOf("background")&&(i.background[t]=e)}),n.getPanel(t).setData("all",i)}),f(".panel-spinner").css({display:"",visibility:""}),e()}})},saveAccordion:function(){var t=this.getAccordionData();t.nonce=ga_js_vars.sa_nonce,t.action="save";var t=JSON.stringify(t),e=f(".update-spinner").css({display:"inline-block",visibility:"visible"});f.ajax({url:ga_js_vars.ajaxurl,type:"post",data:{action:"grid_accordion_save_accordion",data:t},complete:function(t){e.css({display:"",visibility:""}),-1===parseInt(ga_js_vars.id,10)&&!1===isNaN(t.responseText)?(f("h2").after('<div class="updated"><p>'+ga_js_vars.accordion_create+"</p></div>"),window.location=ga_js_vars.admin+"?page=grid-accordion&id="+t.responseText+"&action=edit"):0===f(".updated").length&&f("h2").after('<div class="updated"><p>'+ga_js_vars.accordion_update+"</p></div>")}})},getAccordionData:function(){var n=this,a={id:ga_js_vars.id,name:f("input#title").val(),settings:{},panels:[],panels_state:{}},i=[];return f(".panels-container").find(".panel").each(function(t){var e=f(this),i=n.getPanel(parseInt(e.attr("data-id"),10)).getData("all");i.position=parseInt(e.attr("data-position"),10),a.panels[t]=i}),f(".sidebar-settings").find(".setting").each(function(){var t=f(this);a.settings[t.attr("name")]="checkbox"===t.attr("type")?t.is(":checked"):t.val()}),f(".breakpoints").find(".breakpoint").each(function(){var t=f(this),e={breakpoint_width:t.find('input[name="breakpoint_width"]').val()};t.find(".breakpoint-setting").each(function(){var t=f(this);e[t.attr("name")]="checkbox"===t.attr("type")?t.is(":checked"):t.val()}),i.push(e)}),0<i.length&&(a.settings.breakpoints=i),f(".sidebar-settings").find(".postbox").each(function(){var t=f(this);a.panels_state[t.attr("data-name")]=t.hasClass("closed")?"closed":""}),a},previewAccordion:function(){y.open(this.getAccordionData())},previewAccordionAll:function(t){var e=f.lightURLParse(t.attr("href")),t=e.lad_nonce,e=parseInt(e.id,10);f.ajax({url:ga_js_vars.ajaxurl,type:"get",data:{action:"grid_accordion_get_accordion_data",id:e,nonce:t},complete:function(t){t=f.parseJSON(t.responseText);y.open(t)}})},deleteAccordion:function(t){var e=f.lightURLParse(t.attr("href")),i=e.da_nonce,n=parseInt(e.id,10),a=t.parents("tr"),o=f('<div class="modal-overlay"></div><div class="modal-window-container">\t<div class="modal-window delete-accordion-dialog">\t\t<p class="dialog-question">'+ga_js_vars.accordion_delete+'</p>\t\t<div class="dialog-buttons">\t\t\t<a class="button dialog-ok" href="#">'+ga_js_vars.yes+'</a>\t\t\t<a class="button dialog-cancel" href="#">'+ga_js_vars.cancel+"</a>\t\t</div>\t</div></div>").appendTo("body");o.find(".dialog-ok").one("click",function(t){t.preventDefault(),f.ajax({url:ga_js_vars.ajaxurl,type:"post",data:{action:"grid_accordion_delete_accordion",id:n,nonce:i},complete:function(t){n===parseInt(t.responseText,10)&&a.fadeOut(300,function(){a.remove()})}}),o.remove()}),o.find(".dialog-cancel").one("click",function(t){t.preventDefault(),o.remove()}),o.find(".modal-overlay").one("click",function(t){o.remove()})},duplicateAccordion:function(t){var e=f.lightURLParse(t.attr("href")),t=e.dua_nonce,e=parseInt(e.id,10);f.ajax({url:ga_js_vars.ajaxurl,type:"post",data:{action:"grid_accordion_duplicate_accordion",id:e,nonce:t},complete:function(t){f(t.responseText).appendTo(f(".accordions-list tbody")).hide().fadeIn()}})},exportAccordion:function(t){var e=f.lightURLParse(t.attr("href")),t=e.ea_nonce,e=parseInt(e.id,10);i.open(e,t)},initPanels:function(){var e=this;f(".panels-container").find(".panel").each(function(t){e.initPanel(f(this))}),f(".panels-container").lightSortable({children:".panel",placeholder:"panel panel-placeholder",sortEnd:function(t){f(".panel").each(function(t){f(this).attr("data-position",t)})}})},initPanel:function(t,e){var i=this,t=t,e=new o(t,this.panelCounter,e);this.panels.push(e),e.on("duplicatePanel",function(t){i.duplicatePanel(t.panelData)}),e.on("deletePanel",function(t){i.deletePanel(t.id)}),t.attr("data-id",this.panelCounter),t.attr("data-position",this.panelCounter),this.panelCounter++},getPanel:function(i){var n;return f.each(this.panels,function(t,e){if(e.id===i)return n=e,!1}),n},duplicatePanel:function(t){var e=this,i=f.extend(!0,{},t),t=[{settings:{content_type:i.settings.content_type},background_source:i.background.background_source}];f.ajax({url:ga_js_vars.ajaxurl,type:"post",data:{action:"grid_accordion_add_panels",data:JSON.stringify(t)},complete:function(t){t=f(t.responseText).appendTo(f(".panels-container"));e.initPanel(t,i)}})},deletePanel:function(t){var e=this,i=e.getPanel(t),n=f('<div class="modal-overlay"></div><div class="modal-window-container">\t<div class="modal-window delete-panel-dialog">\t\t<p class="dialog-question">'+ga_js_vars.panel_delete+'</p>\t\t<div class="dialog-buttons">\t\t\t<a class="button dialog-ok" href="#">'+ga_js_vars.yes+'</a>\t\t\t<a class="button dialog-cancel" href="#">'+ga_js_vars.cancel+"</a>\t\t</div>\t</div></div>").appendTo("body");n.find(".dialog-ok").one("click",function(t){t.preventDefault(),i.off("duplicatePanel"),i.off("deletePanel"),i.remove(),n.remove(),e.panels.splice(f.inArray(i,e.panels),1)}),n.find(".dialog-cancel").one("click",function(t){t.preventDefault(),n.remove()}),n.find(".modal-overlay").one("click",function(t){n.remove()})},addEmptyPanel:function(){var e=this;f.ajax({url:ga_js_vars.ajaxurl,type:"post",data:{action:"grid_accordion_add_panels"},complete:function(t){t=f(t.responseText).appendTo(f(".panels-container"));e.initPanel(t)}})},addImagePanels:function(){var n=this;v.open(function(t){var i=[];f.each(t,function(t,e){i.push({background_source:e.url,background_alt:e.alt,background_title:e.title,background_width:e.width,background_height:e.height})}),f.ajax({url:ga_js_vars.ajaxurl,type:"post",data:{action:"grid_accordion_add_panels",data:JSON.stringify(i)},complete:function(t){var e=f(".panels-container").find(".panel").length-1,e=-1==e?"":":gt("+e+")";f(".panels-container").append(t.responseText).find(".panel"+e).each(function(t){var e=f(this);n.initPanel(e,{background:i[t],layers:{},html:"",settings:{}})})}})})},addPostsPanels:function(){var i=this;f.ajax({url:ga_js_vars.ajaxurl,type:"post",data:{action:"grid_accordion_add_panels",data:JSON.stringify([{settings:{content_type:"posts"}}])},complete:function(t){var e=f(t.responseText).appendTo(f(".panels-container")),t=i.panelCounter;i.initPanel(e,{background:{background_source:"[ga_image_src]",background_alt:"[ga_image_alt]",background_link:"[ga_link_url]"},layers:[{id:1,name:"Layer 1",type:"paragraph",text:"[ga_title]",settings:{position:"bottomLeft",horizontal:"0",vertical:"0",preset_styles:["ga-black","ga-padding"]}}],html:"",settings:{content_type:"posts"}}),g.open(t)}})},addGalleryPanels:function(){var i=this;f.ajax({url:ga_js_vars.ajaxurl,type:"post",data:{action:"grid_accordion_add_panels",data:JSON.stringify([{settings:{content_type:"gallery"}}])},complete:function(t){var e=f(t.responseText).appendTo(f(".panels-container")),t=i.panelCounter;i.initPanel(e,{background:{background_source:"[ga_image_src]",background_alt:"[ga_image_alt]"},layers:{},html:"",settings:{content_type:"gallery"}}),g.open(t)}})},addFlickrPanels:function(){var i=this;f.ajax({url:ga_js_vars.ajaxurl,type:"post",data:{action:"grid_accordion_add_panels",data:JSON.stringify([{settings:{content_type:"flickr"}}])},complete:function(t){var e=f(t.responseText).appendTo(f(".panels-container")),t=i.panelCounter;i.initPanel(e,{background:{background_source:"[ga_image_src]",background_link:"[ga_image_link]"},layers:[{id:1,name:"Layer 1",type:"paragraph",text:"[ga_image_description]",settings:{position:"bottomLeft",horizontal:"0",vertical:"0",preset_styles:["ga-black","ga-padding"]}}],html:"",settings:{content_type:"flickr"}}),g.open(t)}})},addBreakpoint:function(){var t="",e=f('input[name="breakpoint_width"]').last().val();void 0===e?t="960":""!==e&&(t=e-190),f.ajax({url:ga_js_vars.ajaxurl,type:"get",data:{action:"grid_accordion_add_breakpoint",data:t},complete:function(t){f(t.responseText).appendTo(f(".breakpoints"))}})},addBreakpointSetting:function(t,e){f.ajax({url:ga_js_vars.ajaxurl,type:"get",data:{action:"grid_accordion_add_breakpoint_setting",data:t},complete:function(t){f(t.responseText).appendTo(e)}})},getTaxonomies:function(t,e){var i=this,n=[];f.each(t,function(t,e){void 0===i.postsData[e]&&n.push(e)}),0!==n.length?f.ajax({url:ga_js_vars.ajaxurl,type:"get",data:{action:"grid_accordion_get_taxonomies",post_names:JSON.stringify(n)},complete:function(t){t=f.parseJSON(t.responseText);f.each(t,function(t,e){i.postsData[t]=e}),e(i.postsData)}}):e(this.postsData)},showInfo:function(t){var e=t,t=e.attr("data-info"),i=null;void 0!==t&&(i=f('<div class="info-tooltip">'+t+"</div>").appendTo(e.parent())).css({left:-i.outerWidth(!0),marginTop:.5*-i.outerHeight(!0)-9}),e.on("mouseout",function(){null!==i&&i.remove()})},resizePanelImages:function(){var e=f(".panel-preview").width()/f(".panel-preview").height();f(".panel-preview > img").each(function(){var t=f(this);t.width()/t.height()>e?t.css({width:"auto",height:"100%"}):t.css({width:"100%",height:"auto"})})}},i={exportWindow:null,open:function(t,e){var i=this;f.ajax({url:ga_js_vars.ajaxurl,type:"post",data:{action:"grid_accordion_export_accordion",id:t,nonce:e},complete:function(t){i.exportWindow=f(t.responseText).appendTo(f("body")),i.init()}})},init:function(){var e=this;this.exportWindow.find(".close-x").on("click",function(t){t.preventDefault(),e.close()}),this.exportWindow.find("textarea").on("click",function(t){t.preventDefault(),f(this).focus(),f(this).select()})},close:function(){this.exportWindow.find(".close-x").off("click"),this.exportWindow.find("textarea").off("click"),this.exportWindow.remove()}},a={importWindow:null,open:function(){var e=this;f.ajax({url:ga_js_vars.ajaxurl,type:"post",data:{action:"grid_accordion_import_accordion"},complete:function(t){e.importWindow=f(t.responseText).appendTo(f("body")),e.init()}})},init:function(){var e=this;this.importWindow.find(".close-x").on("click",function(t){t.preventDefault(),e.close()}),this.importWindow.find(".save").on("click",function(t){t.preventDefault(),e.save()})},save:function(){var t,e=this,i=this.importWindow.find("textarea").val();""!==i&&((t=f.parseJSON(i)).id=-1,t.nonce=ga_js_vars.sa_nonce,t.action="import",i=JSON.stringify(t),f.ajax({url:ga_js_vars.ajaxurl,type:"post",data:{action:"grid_accordion_save_accordion",data:i},complete:function(t){0!==f(".accordions-list .no-accordion-row").length&&f(".accordions-list .no-accordion-row").remove(),f(t.responseText).appendTo(f(".accordions-list tbody")).hide().fadeIn(),e.close()}}))},close:function(){this.importWindow.find(".close-x").off("click"),this.importWindow.find(".save").off("click"),this.importWindow.remove()}},o=function(t,e,i){this.$panel=t,this.id=e,this.data=i,this.events=f({}),void 0===this.data&&(this.data={background:{},layers:{},html:"",settings:{}}),this.init()},e={editor:null,currentPanel:null,needsPreviewUpdate:!(o.prototype={init:function(){var i=this;this.$panel.find(".panel-preview").on("click",function(t){var e=i.getData("settings").content_type;void 0!==e&&"custom"!==e||v.open(function(t){t=t[0];i.setData("background",{background_source:t.url,background_alt:t.alt,background_title:t.title,background_width:t.width,background_height:t.height}),i.updatePanelPreview()})}),this.$panel.find(".edit-background-image").on("click",function(t){t.preventDefault(),e.open(i.id)}),this.$panel.find(".edit-layers").on("click",function(t){t.preventDefault(),d.open(i.id)}),this.$panel.find(".edit-html").on("click",function(t){t.preventDefault(),r.open(i.id)}),this.$panel.find(".edit-settings").on("click",function(t){t.preventDefault(),g.open(i.id)}),this.$panel.find(".delete-panel").on("click",function(t){t.preventDefault(),i.trigger({type:"deletePanel",id:i.id})}),this.$panel.find(".duplicate-panel").on("click",function(t){t.preventDefault(),i.trigger({type:"duplicatePanel",panelData:i.data})}),this.resizeImage()},getData:function(t){if("all"!==t)return"background"===t?this.data.background:"layers"===t?this.data.layers:"html"===t?this.data.html:"settings"===t?this.data.settings:void 0;var i={};return f.each(this.data.background,function(t,e){i[t]=e}),i.layers=this.data.layers,i.html=this.data.html,i.settings=this.data.settings,i},setData:function(t,e){var i=this;"all"===t?this.data=e:"background"===t?f.each(e,function(t,e){i.data.background[t]=e}):"layers"===t?this.data.layers=e:"html"===t?this.data.html=e:"settings"===t&&(this.data.settings=e)},remove:function(){this.$panel.find(".panel-preview").off("click"),this.$panel.find(".edit-background-image").off("click"),this.$panel.find(".edit-layers").off("click"),this.$panel.find(".edit-html").off("click"),this.$panel.find(".edit-settings").off("click"),this.$panel.find(".delete-panel").off("click"),this.$panel.find(".duplicate-panel").off("click"),this.$panel.fadeOut(500,function(){f(this).remove()})},updatePanelPreview:function(){var t,e=this.$panel.find(".panel-preview"),i=this.data.settings.content_type;e.empty(),void 0===i||"custom"===i?(void 0!==(t=this.data.background.background_source)&&""!==t?(f('<img src="'+t+'" />').appendTo(e),this.resizeImage()):f('<p class="no-image">'+ga_js_vars.no_image+"</p>").appendTo(e),this.$panel.removeClass("dynamic-panel")):"posts"===i?(f("<p>[ "+ga_js_vars.posts_panels+" ]</p>").appendTo(e),this.$panel.addClass("dynamic-panel")):"gallery"===i?(f("<p>[ "+ga_js_vars.gallery_panels+" ]</p>").appendTo(e),this.$panel.addClass("dynamic-panel")):"flickr"===i&&(f("<p>[ "+ga_js_vars.flickr_panels+" ]</p>").appendTo(e),this.$panel.addClass("dynamic-panel"))},resizeImage:function(){var t,e=this.$panel.find(".panel-preview"),i=this.$panel.find(".panel-preview > img");i.length&&(t=setInterval(function(){!0===i[0].complete&&(clearInterval(t),i.width()/i.height()>e.width()/e.height()?i.css({width:"auto",height:"100%"}):i.css({width:"100%",height:"auto"}))},100))},on:function(t,e){this.events.on(t,e)},off:function(t){this.events.off(t)},trigger:function(t){this.events.triggerHandler(t)}}),open:function(t){this.currentPanel=s.getPanel(t);var e=this,i=this.currentPanel.getData("background"),n=this.currentPanel.getData("settings").content_type,a=f('.panel[data-id="'+t+'"]').find(".panel-spinner").css({display:"inline-block",visibility:"visible"});void 0===n&&(n="custom"),f.ajax({url:ga_js_vars.ajaxurl,type:"post",dataType:"html",data:{action:"grid_accordion_load_background_image_editor",data:JSON.stringify(i),content_type:n},complete:function(t){f("body").append(t.responseText),e.init(),a.css({display:"",visibility:""})}})},init:function(){var e=this;this.$editor=f(".background-image-editor"),this.$editor.find(".close-x").on("click",function(t){t.preventDefault(),e.save(),e.close()}),this.$editor.find(".image-loader, .retina-loader").on("click",function(t){t.preventDefault(),e.openMediaLibrary(t)}),this.$editor.find(".clear-fieldset").on("click",function(t){t.preventDefault(),e.clearFieldset(t)}),this.$editor.find('input[name="background_source"]').on("input",function(t){e.needsPreviewUpdate=!0}),f(window).on("resize.backgroundImageEditor",function(){e.$editor.find(".modal-window").outerWidth()>=f(window).width()?e.$editor.addClass("modal-window-left"):e.$editor.removeClass("modal-window-left"),e.$editor.find(".modal-window").outerHeight()>=f(window).height()-60?e.$editor.addClass("modal-window-top"):e.$editor.removeClass("modal-window-top")}),this.$editor.find(".show-hide-info, .show-hide-dynamic-tags").on("click",function(){f(window).trigger("resize")}),f(window).trigger("resize.backgroundImageEditor")},openMediaLibrary:function(t){t.preventDefault();var e=this,i=!0===f(t.target).parents(".fieldset").hasClass("opened-background-image")?"opened-background":"background",n=this.$editor.find("."+i+"-image .image-loader"),a=f(t.target).hasClass("retina-loader");v.open(function(t){t=t[0];!0===a?"background"==i?e.$editor.find('input[name="background_retina_source"]').val(t.url):"opened-background"==i&&e.$editor.find('input[name="opened_background_retina_source"]').val(t.url):(0!==n.find("img").length?n.find("img").attr("src",t.url):(n.find(".no-image").remove(),f('<img src="'+t.url+'" />').appendTo(n)),"background"==i?(e.$editor.find('input[name="background_source"]').val(t.url),e.$editor.find('input[name="background_alt"]').val(t.alt),e.$editor.find('input[name="background_title"]').val(t.title),e.$editor.find('input[name="background_width"]').val(t.width),e.$editor.find('input[name="background_height"]').val(t.height),e.needsPreviewUpdate=!0):"opened-background"==i&&(e.$editor.find('input[name="opened_background_source"]').val(t.url),e.$editor.find('input[name="opened_background_alt"]').val(t.alt),e.$editor.find('input[name="opened_background_title"]').val(t.title),e.$editor.find('input[name="opened_background_width"]').val(t.width),e.$editor.find('input[name="opened_background_height"]').val(t.height)))})},clearFieldset:function(t){t.preventDefault();var e=f(t.target).parents(".fieldset"),t=e.find(".image-loader");e.find("input").val(""),0!==t.find("img").length&&(t.find("img").remove(),f('<p class="no-image">'+ga_js_vars.no_image+"</p>").appendTo(t),this.needsPreviewUpdate=!0)},save:function(){var e={};this.$editor.find(".field").each(function(){var t=f(this);e[t.attr("name")]=t.val()}),this.currentPanel.setData("background",e),!0===this.needsPreviewUpdate&&(this.currentPanel.updatePanelPreview(),this.needsPreviewUpdate=!1)},close:function(){this.$editor.find(".close-x").off("click"),this.$editor.find(".image-loader").off("click"),this.$editor.find(".retina-loader").off("click"),this.$editor.find(".clear-fieldset").off("click"),this.$editor.find('input[name="background_source"]').off("input"),f(window).off("resize.backgroundImageEditor"),f("body").find(".modal-overlay, .modal-window-container").remove()}},r={editor:null,currentPanel:null,open:function(t){this.currentPanel=s.getPanel(t);var e=this,i=this.currentPanel.getData("html"),n=f('.panel[data-id="'+t+'"]').find(".panel-spinner").css({display:"inline-block",visibility:"visible"}),t=this.currentPanel.getData("settings").content_type;f.ajax({url:ga_js_vars.ajaxurl,type:"post",dataType:"html",data:{action:"grid_accordion_load_html_editor",data:i,content_type:t},complete:function(t){f("body").append(t.responseText),e.init(),n.css({display:"",visibility:""})}})},init:function(){var e=this;this.$editor=f(".html-editor"),this.$editor.find(".html-code").codeEditor(),this.$editor.find(".close-x").on("click",function(t){t.preventDefault(),e.save(),e.close()}),f(window).on("resize.htmlEditor",function(){e.$editor.find(".modal-window").outerWidth()>=f(window).width()?e.$editor.addClass("modal-window-left"):e.$editor.removeClass("modal-window-left"),e.$editor.find(".modal-window").outerHeight()>=f(window).height()-60?e.$editor.addClass("modal-window-top"):e.$editor.removeClass("modal-window-top")}),this.$editor.find(".show-hide-info, .show-hide-dynamic-tags").on("click",function(){f(window).trigger("resize")}),f(window).trigger("resize")},save:function(){this.currentPanel.setData("html",this.$editor.find(".html-code").data("codeEditor").getValue())},close:function(){this.$editor.find(".close-x").off("click"),this.$editor.find(".html-code").codeEditor("destroy"),f("window").off("resize.htmlEditor"),f("body").find(".modal-overlay, .modal-window-container").remove()}},d={editor:null,currentPanel:null,layersData:null,layers:[],counter:0,isWorking:!1,open:function(t){this.currentPanel=s.getPanel(t),this.layersData=this.currentPanel.getData("layers");var e=this,i=f('.panel[data-id="'+t+'"]').find(".panel-spinner").css({display:"inline-block",visibility:"visible"}),t=this.currentPanel.getData("settings").content_type;f.ajax({url:ga_js_vars.ajaxurl,type:"post",dataType:"html",data:{action:"grid_accordion_load_layers_editor",data:JSON.stringify(this.layersData),content_type:t},complete:function(t){f("body").append(t.responseText),e.init(),i.css({display:"",visibility:""})}})},init:function(){var a=this;this.counter=0,this.$editor=f(".layers-editor"),this.$editor.find(".close-x").on("click",function(t){t.preventDefault(),a.save(),a.close()}),f(window).on("resize.layersEditor",function(){a.$editor.find(".modal-window").outerWidth()>=f(window).width()?a.$editor.addClass("modal-window-left"):a.$editor.removeClass("modal-window-left"),a.$editor.find(".modal-window").outerHeight()>=f(window).height()-60?a.$editor.addClass("modal-window-top"):a.$editor.removeClass("modal-window-top")}),this.$editor.find(".show-hide-info").on("click",function(){f(window).trigger("resize")}),this.$editor.find(".add-layer-group").on("click",function(t){var e;t.preventDefault(),!0!==a.isWorking&&(e="paragraph",void 0!==f(t.target).attr("data-type")&&(e=f(t.target).attr("data-type")),a.addNewLayer(e))}),this.$editor.find(".delete-layer").on("click",function(t){t.preventDefault(),a.deleteLayer()}),this.$editor.find(".duplicate-layer").on("click",function(t){t.preventDefault(),!0!==a.isWorking&&a.duplicateLayer()}),this.initViewport(),f.each(this.layersData,function(t,e){e.createMode="init",a.createLayer(e),a.counter=Math.max(a.counter,e.id)}),f(".list-layers").lightSortable({children:".list-layer",placeholder:"list-layer-placeholder",sortEnd:function(t){var e,i,n;t.startPosition!==t.endPosition&&(n=a.layers[t.startPosition],a.layers.splice(t.startPosition,1),a.layers.splice(t.endPosition,0,n),i=(e=a.$editor.find(".viewport-layers")).children().length-1,f(".list-layers").find(".list-layer").each(function(t,e){f(e).attr("data-position",t)}),n=e.find(".viewport-layer").eq(i-t.startPosition).detach(),i-t.startPosition<i-t.endPosition?n.insertAfter(e.find(".viewport-layer").eq(i-1-t.endPosition)):n.insertBefore(e.find(".viewport-layer").eq(i-t.endPosition)))}}),f(".list-layers").find(".list-layer").each(function(t,e){f(e).attr("data-position",t)}),0!==this.layers.length&&this.layers[0].triggerSelect(),f(window).trigger("resize.layersEditor")},initViewport:function(){var i,n,a,o,t=f(".sidebar-settings").find('.setting[name="width"]').val(),e=f(".sidebar-settings").find('.setting[name="height"]').val(),s=f(".sidebar-settings").find('.setting[name="orientation"]').val(),r=f(".sidebar-settings").find('.setting[name="custom_class"]').val(),d=f(".sidebar-settings").find('.setting[name="opened_panel_width"]').val(),l=f(".sidebar-settings").find('.setting[name="opened_panel_height"]').val(),c=f(".sidebar-settings").find('.setting[name="max_opened_panel_width"]').val(),h=f(".sidebar-settings").find('.setting[name="max_opened_panel_height"]').val(),p=this.currentPanel.getData("background").background_source,u=this.$editor.find(".layer-viewport"),g=f('<div class="grid-accordion viewport-layers"></div>').appendTo(u),t=isNaN(t)?parseInt(t,10)/100*f(window).width():parseInt(t,10),e=isNaN(e)?parseInt(e,10)/100*f(window).height():parseInt(e,10);"horizontal"===s?u.css("height",e):u.css("width",t),""!==r&&g.addClass(r),i="max"===d||"auto"===d?isNaN(c)?parseInt(c,10)/100*t:parseInt(c,10):isNaN(d)?parseInt(d,10)/100*t:parseInt(d,10),n="max"===l||"auto"===l?isNaN(h)?parseInt(h,10)/100*e:parseInt(h,10):isNaN(l)?parseInt(l,10)/100*e:parseInt(l,10),void 0!==p&&""!==p&&-1===p.indexOf("[")?(a=f('<img class="viewport-image" src="'+p+'" />').prependTo(u),o=setInterval(function(){var t,e;!0===a[0].complete&&(clearInterval(o),a.css({"max-width":i,"max-height":n}),t=a.width(),e=a.height(),t<i&&(i=t),e<n&&(n=e),u.css({width:i,height:n}),g.css({width:i,height:n}))},10)):(u.css({width:i,height:n}),g.css({width:i,height:n})),f(".layers-editor-info").css("max-width",u.width())},createLayer:function(t){var e,n=this;"paragraph"===t.type?e=new l(t):"heading"===t.type?e=new c(t):"image"===t.type?e=new h(t):"div"===t.type?e=new p(t):"video"===t.type&&(e=new u(t)),"new"===t.createMode||"duplicate"===t.createMode?this.layers.unshift(e):this.layers.push(e),e.on("select",function(i){f.each(n.layers,function(t,e){!0===e.isSelected()&&e.deselect(),e.getID()===i.id&&e.select()})}),e.triggerSelect(),this.isWorking=!1,this.$editor.removeClass("no-layers")},addNewLayer:function(e){var i=this;this.isWorking=!0,this.counter++,f.ajax({url:ga_js_vars.ajaxurl,type:"post",dataType:"html",data:{action:"grid_accordion_add_layer_settings",id:this.counter,type:e},complete:function(t){f(t.responseText).appendTo(f(".layers-settings")),f('<li class="list-layer" data-id="'+i.counter+'" data-position="'+i.layers.length+'">Layer '+i.counter+"</li>").prependTo(i.$editor.find(".list-layers")),i.createLayer({id:i.counter,type:e,createMode:"new"}),f(window).trigger("resize.layersEditor")}})},deleteLayer:function(){var i,n=this;f.each(this.layers,function(t,e){if(!0===e.isSelected())return e.destroy(),n.layers.splice(t,1),i=t,!1}),0!==this.layers.length?(0===i?this.layers[0]:this.layers[i-1]).triggerSelect():this.$editor.addClass("no-layers")},duplicateLayer:function(){var i,e=this;f.each(this.layers,function(t,e){!0===e.isSelected()&&(i=e.getData())}),void 0!==i&&(this.isWorking=!0,this.counter++,f.ajax({url:ga_js_vars.ajaxurl,type:"post",dataType:"html",data:{action:"grid_accordion_add_layer_settings",id:this.counter,type:i.type,text:i.text,heading_type:i.heading_type,image_source:i.image_source,image_alt:i.image_alt,image_link:i.image_link,image_retina:i.image_retina,settings:JSON.stringify(i.settings)},complete:function(t){f(t.responseText).appendTo(f(".layers-settings")),f('<li class="list-layer" data-id="'+e.counter+'">Layer '+e.counter+"</li>").prependTo(e.$editor.find(".list-layers")),i.id=e.counter,i.createMode="duplicate",e.createLayer(i),f(window).trigger("resize.layersEditor")}}))},save:function(){var i=[];f.each(this.layers,function(t,e){i.push(e.getData())}),this.currentPanel.setData("layers",i)},close:function(){this.$editor.find(".close-x").off("click"),this.$editor.find(".add-layer-group").off("click"),this.$editor.find(".delete-layer").off("click"),this.$editor.find(".duplicate-layer").off("click"),f(window).off("resize.layersEditor"),f(".list-layers").lightSortable("destroy"),f.each(this.layers,function(t,e){e.destroy()}),this.layers.length=0,f("body").find(".modal-overlay, .modal-window-container").remove()}};n.prototype={init:function(){this.initLayerContent(),this.initLayerSettings(),this.initViewportLayer(),this.initLayerDragging(),this.initListLayer()},getData:function(){var i={};return i.id=this.id,i.position=parseInt(this.$listLayer.attr("data-position"),10),i.name=this.$listLayer.text(),i.settings={},this.$layerSettings.find(".setting").each(function(){var t=f(this),e=t.attr("type");"radio"===e?t.is(":checked")&&(i.settings[t.attr("name").split("-")[0]]=t.val()):"checkbox"===e?i.settings[t.attr("name")]=t.is(":checked"):t.is("select")&&void 0!==t.attr("multiple")?i.settings[t.attr("name")]=null===t.val()?[]:t.val():i.settings[t.attr("name")]=t.val()}),i},getID:function(){return this.id},select:function(){this.selected=!0,this.$listLayer.addClass("selected-list-layer"),this.$layerSettings.addClass("selected-layer-settings")},deselect:function(){this.selected=!1,this.$listLayer.removeClass("selected-list-layer"),this.$layerSettings.removeClass("selected-layer-settings")},triggerSelect:function(){this.trigger({type:"select",id:this.id})},isSelected:function(){return this.selected},destroy:function(){this.$viewportLayer.off("mousedown"),this.$viewportLayer.off("mouseup"),this.$viewportLayer.off("click"),this.$listLayer.off("click"),this.$listLayer.off("dblclick"),this.$listLayer.off("selectstart"),this.$editor.off("mousemove.layer"+this.id),this.$editor.off("click.layer"+this.id),this.$layerSettings.find('select[name="preset_styles"]').multiCheck("destroy"),this.$layerSettings.find('.setting[name="width"]').off("change"),this.$layerSettings.find('.setting[name="height"]').off("change"),this.$layerSettings.find('.setting[name="position"]').off("change"),this.$layerSettings.find('.setting[name="horizontal"]').off("change"),this.$layerSettings.find('.setting[name="vertical"]').off("change"),this.$layerSettings.find('.setting[name="preset_styles"]').off("change"),this.$layerSettings.find('.setting[name="custom_class"]').off("change"),this.$viewportLayer.remove(),this.$listLayer.remove(),this.$layerSettings.remove()},on:function(t,e){this.events.on(t,e)},off:function(t){this.events.off(t)},trigger:function(t){this.events.triggerHandler(t)},initViewportLayer:function(){var t,e,i=this;this.$viewportLayer.attr("data-id",this.id),"new"===this.data.createMode||"duplicate"===this.data.createMode?this.$viewportLayer.appendTo(this.$viewportLayers):"init"===this.data.createMode&&this.$viewportLayer.prependTo(this.$viewportLayers),"new"===this.data.createMode?(this.$viewportLayer.css({width:"auto",height:"auto",left:0,top:0}),(this.$viewportLayer.hasClass("ga-layer")?this.$viewportLayer:this.$viewportLayer.find(".ga-layer")).addClass("ga-black ga-padding")):"init"!==this.data.createMode&&"duplicate"!==this.data.createMode||(t=null!==this.data.settings.preset_styles?this.data.settings.preset_styles.join(" "):"",t+=" "+this.data.settings.custom_class,(this.$viewportLayer.hasClass("ga-layer")?this.$viewportLayer:this.$viewportLayer.find(".ga-layer")).addClass(t),this.$viewportLayer.css({width:this.data.settings.width,height:this.data.settings.height}),t=-1!==(e=this.data.settings.position.toLowerCase()).indexOf("right")?"right":"left",e=-1!==e.indexOf("bottom")?"bottom":"top","center"===this.data.settings.horizontal?this.$viewportLayer.css({width:this.$viewportLayer.outerWidth(!0),marginLeft:"auto",marginRight:"auto",left:0,right:0}):(suffix=-1===this.data.settings.horizontal.indexOf("px")&&-1===this.data.settings.horizontal.indexOf("%")?"px":"",this.$viewportLayer.css(t,this.data.settings.horizontal+suffix)),"center"===this.data.settings.vertical?this.$viewportLayer.css({height:this.$viewportLayer.outerHeight(!0),marginTop:"auto",marginBottom:"auto",top:0,bottom:0}):(suffix=-1===this.data.settings.vertical.indexOf("px")&&-1===this.data.settings.vertical.indexOf("%")?"px":"",this.$viewportLayer.css(e,this.data.settings.vertical+suffix))),this.$viewportLayer.on("mousedown",function(){i.triggerSelect()}),this.$viewportLayer.on("click","a",function(t){t.preventDefault()})},initLayerDragging:function(){var i=this,e=0,n=0,a=0,o=0,s=!1,r=!1,d=!1;this.$viewportLayer.on("mousedown",function(t){t.preventDefault(),e=t.pageX,n=t.pageY,a=i.$viewportLayer[0].offsetLeft,o=i.$viewportLayer[0].offsetTop,d=!(s=!0)}),this.$editor.find(".viewport-layers").on("mousemove.layer"+this.id,function(t){t.preventDefault(),(d=!0)===s&&(i.$viewportLayer.css({left:a+t.pageX-e,top:o+t.pageY-n}),!1===r&&(r=!0,i.$viewportLayer.css({right:"auto",bottom:"auto"})))}),this.$viewportLayer.on("mouseup",function(t){var e;t.preventDefault(),(r=s=!1)!==d&&(t=-1!==(e=i.$layerSettings.find('.setting[name="position"]').val().toLowerCase()).indexOf("right")?"right":"left",e=-1!==e.indexOf("bottom")?"bottom":"top","left"==t?i.$layerSettings.find('.setting[name="horizontal"]').val(i.$viewportLayer.position().left):"right"==t&&(t=i.$editor.find(".viewport-layers").width()-i.$viewportLayer.position().left-i.$viewportLayer.outerWidth(!0),i.$layerSettings.find('.setting[name="horizontal"]').val(t),i.$viewportLayer.css({left:"auto",right:t})),"top"==e?i.$layerSettings.find('.setting[name="vertical"]').val(i.$viewportLayer.position().top):"bottom"==e&&(e=i.$editor.find(".viewport-layers").height()-i.$viewportLayer.position().top-i.$viewportLayer.outerHeight(!0),i.$layerSettings.find('.setting[name="vertical"]').val(e),i.$viewportLayer.css({top:"auto",bottom:e})))})},initListLayer:function(){var n=this,a=!1;this.$listLayer.on("click",function(t){n.trigger({type:"select",id:n.id})}),this.$listLayer.on("dblclick",function(t){var e,i;!0!==a&&(a=!0,e=n.$listLayer.text(),(i=f('<input type="text" value="'+e+'" />').appendTo(n.$listLayer)).on("change",function(){a=!1;var t=""!==i.val()?i.val():"Layer "+n.id;n.$listLayer.text(t),i.remove()}))}),this.$listLayer.on("selectstart",function(t){t.preventDefault()}),this.$editor.on("click.layer"+this.id,function(t){var e;f(t.target).is("input")||!0!==a||(a=!1,t=""!==(e=n.$listLayer.find("input")).val()?e.val():"Layer "+n.id,n.$listLayer.text(t),e.remove())})},initLayerContent:function(){},initLayerSettings:function(){var n=this,i=this.$layerSettings.find('.setting[name="position"]').val().toLowerCase(),a=(i.indexOf("right"),0),o=(i.indexOf("bottom"),0);this.$layerSettings.find('select[name="preset_styles"]').multiCheck({width:120}),this.$layerSettings.find('.setting[name="width"]').on("change",function(){n.$viewportLayer.css("width",f(this).val())}),this.$layerSettings.find('.setting[name="height"]').on("change",function(){n.$viewportLayer.css("height",f(this).val())}),this.$layerSettings.find('.setting[name="position"], .setting[name="horizontal"], .setting[name="vertical"]').on("change",function(){var t=n.$layerSettings.find('.setting[name="horizontal"]').val(),e=n.$layerSettings.find('.setting[name="vertical"]').val();i=n.$layerSettings.find('.setting[name="position"]').val().toLowerCase(),a=-1!==i.indexOf("right")?"right":"left",o=-1!==i.indexOf("bottom")?"bottom":"top",n.$viewportLayer.css({top:"auto",bottom:"auto",left:"auto",right:"auto"}),"center"===t?n.$viewportLayer.css({width:n.$viewportLayer.outerWidth(!0),marginLeft:"auto",marginRight:"auto",left:0,right:0}):(suffix=-1===t.indexOf("px")&&-1===t.indexOf("%")?"px":"",n.$viewportLayer.css(a,t+suffix)),"center"===e?n.$viewportLayer.css({height:n.$viewportLayer.outerHeight(!0),marginTop:"auto",marginBottom:"auto",top:0,bottom:0}):(suffix=-1===e.indexOf("px")&&-1===e.indexOf("%")?"px":"",n.$viewportLayer.css(o,e+suffix))}),this.$layerSettings.find('.setting[name="preset_styles"], .setting[name="custom_class"]').on("change",function(){var t="",e=n.$layerSettings.find('.setting[name="preset_styles"]').val(),i=n.$layerSettings.find('.setting[name="custom_class"]').val();t+=null!==e?" "+e.join(" "):"",t+=""!==i?" "+i:"",n.$viewportLayer.hasClass("ga-layer")?n.$viewportLayer.attr("class","viewport-layer ga-layer"+t):n.$viewportLayer.find(".ga-layer").attr("class","ga-layer"+t)})}};var l=function(t){n.call(this,t)};l.prototype=Object.create(n.prototype),(l.prototype.constructor=l).prototype.initLayerContent=function(){var t=this;this.text="new"===this.data.createMode?this.$layerSettings.find('textarea[name="text"]').val():this.data.text,this.$layerSettings.find('textarea[name="text"]').on("input",function(){t.text=f(this).val(),t.$viewportLayer.html(t.text)})},l.prototype.initViewportLayer=function(){this.$viewportLayer=f('<p class="viewport-layer ga-layer">'+this.text+"</p>"),n.prototype.initViewportLayer.call(this)},l.prototype.getData=function(){var t=n.prototype.getData.call(this);return t.type="paragraph",t.text=this.text,t},l.prototype.destroy=function(){this.$layerSettings.find('textarea[name="text"]').off("input"),n.prototype.destroy.call(this)};var c=function(t){n.call(this,t)};c.prototype=Object.create(n.prototype),(c.prototype.constructor=c).prototype.initLayerContent=function(){var e=this;this.headingType="new"===this.data.createMode?"h3":this.data.heading_type,this.headingText="new"===this.data.createMode?this.$layerSettings.find('textarea[name="text"]').val():this.data.text,this.$layerSettings.find('select[name="heading_type"]').on("change",function(){e.headingType=f(this).val();var t=e.$viewportLayer.find(".ga-layer").attr("class");e.$viewportLayer.html("<"+e.headingType+' class="'+t+'">'+e.headingText+"</"+e.headingType+">")}),this.$layerSettings.find('textarea[name="text"]').on("input",function(){e.headingText=f(this).val(),e.$viewportLayer.find(".ga-layer").html(e.headingText)})},c.prototype.initViewportLayer=function(){this.$viewportLayer=f('<div class="viewport-layer"><'+this.headingType+' class="ga-layer">'+this.headingText+"</"+this.headingType+"></div>"),n.prototype.initViewportLayer.call(this)},c.prototype.getData=function(){var t=n.prototype.getData.call(this);return t.type="heading",t.heading_type=this.headingType,t.text=this.headingText,t},c.prototype.destroy=function(){this.$layerSettings.find('select[name="heading_type"]').off("change"),this.$layerSettings.find('textarea[name="text"]').off("input"),n.prototype.destroy.call(this)};var h=function(t){n.call(this,t)};h.prototype=Object.create(n.prototype),(h.prototype.constructor=h).prototype.initLayerContent=function(){var i=this,t=ga_js_vars.plugin+"/admin/assets/css/images/image-placeholder.png";this.imageSource="new"===this.data.createMode?t:this.data.image_source,this.hasPlaceholder="new"===this.data.createMode,this.$layerSettings.find('input[name="image_source"]').on("change",function(){i.imageSource=f(this).val(),""!==i.imageSource?(i.$viewportLayer.attr("src",i.imageSource).removeClass("has-placeholder"),i.hasPlaceholder=!1):(i.$viewportLayer.attr("src",t).addClass("has-placeholder"),i.hasPlaceholder=!0)}),this.$layerSettings.find(".layer-image-loader").on("click",function(t){var e="image_source"===f(t.target).siblings("input").attr("name")?"default":"retina";v.open(function(t){t=t[0];"default"==e?(i.$layerSettings.find('input[name="image_source"]').val(t.url).trigger("change"),i.$layerSettings.find('input[name="image_alt"]').val(t.alt)):"retina"==e&&i.$layerSettings.find('input[name="image_retina"]').val(t.url)})})},h.prototype.initLayerSettings=function(){n.prototype.initLayerSettings.call(this);var t=this;this.$layerSettings.find('.setting[name="preset_styles"], .setting[name="custom_class"]').on("change",function(){!0===t.hasPlaceholder?t.$viewportLayer.addClass("has-placeholder"):t.$viewportLayer.removeClass("has-placeholder")})},h.prototype.initViewportLayer=function(){this.$viewportLayer=f('<img class="viewport-layer ga-layer" src="'+this.imageSource+'" />'),!0===this.hasPlaceholder?this.$viewportLayer.addClass("has-placeholder"):this.$viewportLayer.removeClass("has-placeholder"),n.prototype.initViewportLayer.call(this)},h.prototype.getData=function(){var t=n.prototype.getData.call(this);return t.type="image",t.image_source=this.imageSource,t.image_alt=this.$layerSettings.find('input[name="image_alt"]').val(),t.image_link=this.$layerSettings.find('input[name="image_link"]').val(),t.image_retina=this.$layerSettings.find('input[name="image_retina"]').val(),t},h.prototype.destroy=function(){this.$layerSettings.find('input[name="image_source"]').off("change"),this.$layerSettings.find(".layer-image-loader").off("click"),n.prototype.destroy.call(this)};var p=function(t){n.call(this,t),this.on("select",function(){setTimeout(function(){that.$layerSettings.find(".div-layer-html-code").codeEditor("refresh")},1)}),this.$layerSettings.find(".layer-settings-tab-label").on("click",function(){setTimeout(function(){that.$layerSettings.find(".div-layer-html-code").codeEditor("refresh")},1)})};p.prototype=Object.create(n.prototype),(p.prototype.constructor=p).prototype.initLayerContent=function(){var e=this;this.text="new"===this.data.createMode?this.$layerSettings.find('textarea[name="text"]').val():this.data.text,e.$layerSettings.find(".div-layer-html-code").codeEditor().on("edit",function(t){e.text=t.value,e.$viewportLayer.html(e.text)})},p.prototype.initViewportLayer=function(){this.$viewportLayer=f('<div class="viewport-layer ga-layer">'+this.text+"</div>"),n.prototype.initViewportLayer.call(this)},p.prototype.getData=function(){var t=n.prototype.getData.call(this);return t.type="div",t.text=this.text,t},p.prototype.destroy=function(){this.$layerSettings.find('textarea[name="text"]').off("input"),this.$layerSettings.find(".div-layer-html-code").codeEditor("destroy"),n.prototype.destroy.call(this)};var u=function(t){n.call(this,t)};u.prototype=Object.create(n.prototype),(u.prototype.constructor=u).prototype.initLayerContent=function(){var t=this;this.text="new"===this.data.createMode?this.$layerSettings.find('textarea[name="text"]').val():this.data.text,this.$layerSettings.find('textarea[name="text"]').on("input",function(){t.text=f(this).val()})},u.prototype.initViewportLayer=function(){var i=this;this.$viewportLayer=f('<div class="viewport-layer ga-layer has-placeholder"><span class="video-placeholder"></span></div>'),n.prototype.initViewportLayer.call(this),this.$layerSettings.find('input[name="width"], input[name="height"]').on("change",function(){var t=i.$layerSettings.find('input[name="width"]').val(),e=i.$layerSettings.find('input[name="height"]').val();"auto"===t&&i.$viewportLayer.css("width",300),"auto"===e&&i.$viewportLayer.css("height",150)}),this.$layerSettings.find('input[name="width"], input[name="height"]').trigger("change")},u.prototype.initLayerSettings=function(){n.prototype.initLayerSettings.call(this);var t=this;this.$layerSettings.find('.setting[name="preset_styles"], .setting[name="custom_class"]').on("change",function(){t.$viewportLayer.addClass("has-placeholder")})},u.prototype.getData=function(){var t=n.prototype.getData.call(this);if(t.type="video",""===this.text)return t.text=this.text,t;var e,i=f(this.text);return i.hasClass("ga-video")||i.addClass("ga-video"),i.is("iframe")?(-1===(e=i.attr("src")).indexOf("youtube.com")&&-1===e.indexOf("youtu.be")||-1!==e.indexOf("enablejsapi")||(e+=(-1===e.indexOf("?")?"?":"&")+"enablejsapi=1&wmode=opaque"),-1!==e.indexOf("vimeo.com")&&-1===e.indexOf("api")&&(e+=(-1===e.indexOf("?")?"?":"&")+"api=1"),i.attr("src",e)):i.hasClass("video-js")&&void 0===i.attr("data-videojs-id")&&(i.removeClass("ga-video"),i=f('<div class="ga-video" data-videojs-id="'+i.attr("id")+'"></div>').append(i).clone()),t.text=i[0].outerHTML,t};var g={editor:null,currentPanel:null,needsPreviewUpdate:!(u.prototype.destroy=function(){this.$layerSettings.find('input[name="width"]').off("change"),this.$layerSettings.find('input[name="height"]').off("change"),n.prototype.destroy.call(this)}),open:function(t){this.currentPanel=s.getPanel(t);var e=this,i=this.currentPanel.getData("settings"),n=f('.panel[data-id="'+t+'"]').find(".panel-spinner").css({display:"inline-block",visibility:"visible"});f.ajax({url:ga_js_vars.ajaxurl,type:"post",dataType:"html",data:{action:"grid_accordion_load_settings_editor",data:JSON.stringify(i)},complete:function(t){f("body").append(t.responseText),e.init(),n.css({display:"",visibility:""})}})},init:function(){var e=this;this.$editor=f(".settings-editor"),this.$editor.find(".close, .close-x").on("click",function(t){t.preventDefault(),e.save(),e.close()}),this.$editor.find('.panel-setting[name="content_type"]').on("change",function(){var t=f(this).val();e.loadControls(t),e.needsPreviewUpdate=!0}),"posts"===this.$editor.find('.panel-setting[name="content_type"]').val()&&this.handlePostsSelects(),f(window).on("resize.settingsEditor",function(){e.$editor.find(".modal-window").outerWidth()>=f(window).width()?e.$editor.addClass("modal-window-left"):e.$editor.removeClass("modal-window-left"),e.$editor.find(".modal-window").outerHeight()>=f(window).height()-60?e.$editor.addClass("modal-window-top"):e.$editor.removeClass("modal-window-top")}),this.$editor.on("click",".show-hide-info",function(){f(window).trigger("resize")}),f(window).trigger("resize")},loadControls:function(e){var i=this,t=this.currentPanel.getData("settings");this.$editor.find(".content-type-settings").empty(),f.ajax({url:ga_js_vars.ajaxurl,type:"post",data:{action:"grid_accordion_load_content_type_settings",type:e,data:JSON.stringify(t)},complete:function(t){f(".content-type-settings").append(t.responseText),"posts"===e&&i.handlePostsSelects()}})},handlePostsSelects:function(){var t=this.$editor.find('select[name="posts_post_types"]'),a=this.$editor.find('select[name="posts_taxonomies"]'),o=a.val()||[];t.on("change",function(){var t=f(this).val();a.empty(),null!==t?s.getTaxonomies(t,function(i){f.each(t,function(t,e){e=i[e];f.each(e,function(t,e){var n=f('<optgroup label="'+e.label+'"></optgroup>').appendTo(a);f.each(e.terms,function(t,e){var i=-1!==f.inArray(e.full,o)?' selected="selected"':"";f('<option value="'+e.full+'"'+i+">"+e.name+"</option>").appendTo(n)})})}),a.multiCheck("refresh")}):a.multiCheck("refresh")}),a.on("change",function(t){a.find("option").each(function(){var t=f(this),e=t.attr("value"),i=f.inArray(e,o);!0===t.is(":selected")&&-1===i?o.push(e):!1===t.is(":selected")&&-1!==i&&o.splice(i,1)})}),t.multiCheck({width:215}),a.multiCheck({width:215})},save:function(){var e={};this.$editor.find(".panel-setting").each(function(){var t=f(this);void 0!==t.attr("multiple")?e[t.attr("name")]=null!==t.val()?t.val():[]:"checkbox"===t.attr("type")?e[t.attr("name")]=t.is(":checked"):e[t.attr("name")]=t.val()}),this.currentPanel.setData("settings",e),!0===this.needsPreviewUpdate&&(this.currentPanel.updatePanelPreview(),this.needsPreviewUpdate=!1)},close:function(){this.$editor.find(".close-x").off("click"),this.$editor.find('select[name="posts_post_types"]').multiCheck("destroy"),this.$editor.find('select[name="posts_taxonomies"]').multiCheck("destroy"),this.$editor.find('select[name="content_type"]').off("change"),this.$editor.find('select[name="posts_post_types"]').off("change"),this.$editor.find('select[name="posts_taxonomies"]').off("change"),f(window).off("resize.settingsEditor"),f("body").find(".modal-overlay, .modal-window-container").remove()}},v={open:function(e){var o=[],i=wp.media.editor.insert;wp.media.editor.send.attachment=function(t,e){var i=void 0!==e.sizes[t.size]?e.sizes[t.size]:e.sizes.full,n=i.url,a=i.width,t=i.height,i=e.alt,e=e.title;o.push({url:n,alt:i,title:e,width:a,height:t})},wp.media.editor.insert=function(t){e.call(this,o),wp.media.editor.insert=i},wp.media.editor.open("media-loader")}},y={previewWindow:null,accordion:null,accordionData:null,open:function(t){this.accordionData=t;var e=this,i=f(".preview-spinner").css({display:"inline-block",visibility:"visible"});f("body").append('<div class="modal-overlay"></div><div class="modal-window-container preview-window">\t<div class="modal-window">\t\t<span class="close-x"></span>\t</div></div>'),e.init(),f.ajax({url:ga_js_vars.ajaxurl,type:"post",data:{action:"grid_accordion_preview_accordion",data:JSON.stringify(t)},complete:function(t){e.previewWindow.append(t.responseText),e.previewWindow.css("visibility",""),i.css({display:"",visibility:""}),f(window).trigger("resize")}})},init:function(){var e=this;this.previewWindow=f(".preview-window .modal-window"),this.accordion=this.previewWindow.find(".grid-accordion"),this.previewWindow.css("visibility","hidden"),this.previewWindow.find(".close-x").on("click",function(t){e.close()});var t=this.accordionData.settings.width,i=this.accordionData.settings.height,n=-1!==t.toString().indexOf("%"),a=-1!==i.toString().indexOf("%");!0==n?this.accordion.gridAccordion("width","100%"):t=parseInt(t,10),!0==a&&this.accordion.gridAccordion("height","100%"),f(window).on("resize.gridAccordion",function(){!0==n?e.previewWindow.css("width",f(window).width()*(parseInt(t,10)/100)-60):t>=f(window).width()-60?e.previewWindow.css("width",f(window).width()-60):e.previewWindow.css("width",t),!0==a&&e.previewWindow.css("height",f(window).height()*(parseInt(i,10)/100)-200),e.previewWindow.outerWidth()>=f(window).width()?e.previewWindow.parent().addClass("modal-window-left"):e.previewWindow.parent().removeClass("modal-window-left"),e.previewWindow.outerHeight()>=f(window).height()-60?e.previewWindow.parent().addClass("modal-window-top"):e.previewWindow.parent().removeClass("modal-window-top")})},close:function(){this.previewWindow.find(".close-x").off("click"),f(window).off("resize.gridAccordion"),this.accordion.gridAccordion("destroy"),f("body").find(".modal-overlay, .modal-window-container").remove()}};f(document).ready(function(){s.init()}),window.gridAccordion=window.gridAccordion||{},window.gridAccordion.admin=s,window.gridAccordion.preview=y}(jQuery),function(n){function a(t,e){this.options=e,this.isOpened=!1,this.$select=n(t),this.$multiCheck=null,this.$multiCheckHeader=null,this.$multiCheckContent=null,this.uid=(new Date).valueOf()*Math.random(),this.counter=0,this.init()}a.prototype={init:function(){var e=this;this.settings=n.extend({},this.defaults,this.options),this.$multiCheck=n('<div class="multi-check"></div>').css("width",this.settings.width),this.$multiCheckHeader=n('<button type="button" class="multi-check-header"><span class="multi-check-header-text"></span><span class="multi-check-header-arrow">▼</span></button>').appendTo(this.$multiCheck),this.$multiCheckContent=n('<ul class="multi-check-content"></ul>').appendTo(this.$multiCheck),this.$multiCheckHeader.on("mousedown.multiCheck",function(t){!1===e.isOpened?e.open():!0===e.isOpened&&e.close()}),n(document).on("mousedown.multiCheck."+this.uid,function(t){!1===n.contains(e.$multiCheck[0],t.target)&&e.close()}),this.refresh(),this.$select.after(this.$multiCheck),this.$select.hide(),this.$multiCheckContent.hide()},refresh:function(){var t=this;this.counter=0,this.$multiCheckContent.find(".single-check").off("change.multiCheck"),this.$multiCheckContent.empty(),this.$select.children().each(function(){n(this).is("optgroup")?(n('<li class="group-label">'+n(this).attr("label")+"</li>").appendTo(t.$multiCheckContent),n(this).children().each(function(){t._optionToCheckbox(n(this))})):t._optionToCheckbox(n(this))}),this.$multiCheckContent.find(".single-check").on("change.multiCheck",function(){n(this).is(":checked")?n(this).data("option").prop("selected",!0):n(this).data("option").prop("selected",!1),t.$select.trigger("change"),t._updateHeader()}),this._updateHeader()},_optionToCheckbox:function(t){var e=n('<li class="single-check-container"></li>').appendTo(this.$multiCheckContent),i=n('<input id="single-check-'+this.uid+"-"+this.counter+'" class="single-check" type="checkbox" value="'+t.attr("value")+'"'+(t.is(":selected")?' checked="checked"':"")+" />").appendTo(e);n('<label for="single-check-'+this.uid+"-"+this.counter+'">'+t.text()+"</label>").appendTo(e);i.data("option",t),this.counter++},_updateHeader:function(){var t=this.$multiCheckHeader.find(".multi-check-header-text"),e="",i=0;this.$multiCheckContent.find(".single-check").each(function(){n(this).is(":checked")&&(""!==e&&(e+=", "),e+=n(this).siblings("label").text(),i++)}),0===i?e="Click to select":2<=i&&(e=i+" selected"),t.text(e)},open:function(){this.isOpened=!0,this.$multiCheckContent.show()},close:function(){this.isOpened=!1,this.$multiCheckContent.hide()},destroy:function(){this.$select.removeData("multiCheck"),this.$multiCheckHeader.off("mousedown.multiCheck"),n(document).off("mousedown.multiCheck."+this.uid),this.$multiCheckContent.find(".single-check").off("change.multiCheck"),this.$multiCheck.remove(),this.$select.show()},defaults:{width:200}},n.fn.multiCheck=function(e){var i=Array.prototype.slice.call(arguments,1);return this.each(function(){var t;void 0===n(this).data("multiCheck")?(t=new a(this,e),n(this).data("multiCheck",t)):void 0!==e&&("function"==typeof(t=n(this).data("multiCheck"))[e]?t[e].apply(t,i):n.error(e+" does not exist in multiCheck."))})}}(jQuery),function(n){function a(t,e){this.options=e,this.$container=n(t),this.$selectedChild=null,this.$placeholder=null,this.currentMouseX=0,this.currentMouseY=0,this.panelInitialX=0,this.panelInitialY=0,this.initialMouseX=0,this.initialMouseY=0,this.isDragging=!1,this.checkHover=0,this.uid=(new Date).valueOf(),this.events=n({}),this.startPosition=0,this.endPosition=0,this.init()}a.prototype={init:function(){this.settings=n.extend({},this.defaults,this.options),this.$container.on("mousedown.lightSortable"+this.uid,n.proxy(this._onDragStart,this)),n(document).on("mousemove.lightSortable."+this.uid,n.proxy(this._onDragging,this)),n(document).on("mouseup.lightSortable."+this.uid,n.proxy(this._onDragEnd,this))},_onDragStart:function(t){1!==t.which||n(t.target).is("select")||n(t.target).is("input")||n(t.target).is("a")||(this.$selectedChild=n(t.target).is(this.settings.children)?n(t.target):n(t.target).parents(this.settings.children),1===this.$selectedChild.length&&(this.initialMouseX=t.pageX,this.initialMouseY=t.pageY,this.panelInitialX=this.$selectedChild.position().left,this.panelInitialY=this.$selectedChild.position().top,this.startPosition=this.$selectedChild.index(),t.preventDefault()))},_onDragging:function(t){var e;null!==this.$selectedChild&&0!==this.$selectedChild.length&&(t.preventDefault(),this.currentMouseX=t.pageX,this.currentMouseY=t.pageY,this.isDragging||(this.isDragging=!0,this.trigger({type:"sortStart"}),n.isFunction(this.settings.sortStart)&&this.settings.sortStart.call(this,{type:"sortStart"}),t=this.$container.is("ul")||this.$container.is("ol")?"li":"div",this.$placeholder=n("<"+t+">").addClass("ls-ignore "+this.settings.placeholder).insertAfter(this.$selectedChild),0===this.$placeholder.width()&&this.$placeholder.css("width",this.$selectedChild.outerWidth()),0===this.$placeholder.height()&&this.$placeholder.css("height",this.$selectedChild.outerHeight()),this.$selectedChild.css({"pointer-events":"none",position:"absolute",left:this.$selectedChild.position().left,top:this.$selectedChild.position().top,width:this.$selectedChild.width(),height:this.$selectedChild.height()}).addClass("ls-ignore"),this.$container.append(this.$selectedChild),n("body").css("user-select","none"),(e=this).checkHover=setInterval(function(){e.$container.find(e.settings.children).not(".ls-ignore").each(function(){var t=n(this);e.currentMouseX>t.offset().left&&e.currentMouseX<t.offset().left+t.width()&&e.currentMouseY>t.offset().top&&e.currentMouseY<t.offset().top+t.height()&&(t.index()>=e.$placeholder.index()?e.$placeholder.insertAfter(t):e.$placeholder.insertBefore(t))})},200)),this.$selectedChild.css({left:this.currentMouseX-this.initialMouseX+this.panelInitialX,top:this.currentMouseY-this.initialMouseY+this.panelInitialY}))},_onDragEnd:function(){this.isDragging&&(this.isDragging=!1,n("body").css("user-select",""),this.$selectedChild.css({position:"",left:"",top:"",width:"",height:"","pointer-events":""}).removeClass("ls-ignore").insertAfter(this.$placeholder),this.$placeholder.remove(),clearInterval(this.checkHover),this.endPosition=this.$selectedChild.index(),this.trigger({type:"sortEnd"}),n.isFunction(this.settings.sortEnd)&&this.settings.sortEnd.call(this,{type:"sortEnd",startPosition:this.startPosition,endPosition:this.endPosition})),this.$selectedChild=null},destroy:function(){this.$container.removeData("lightSortable"),this.isDragging&&this._onDragEnd(),this.$container.off("mousedown.lightSortable."+this.uid),n(document).off("mousemove.lightSortable."+this.uid),n(document).off("mouseup.lightSortable."+this.uid)},on:function(t,e){return this.events.on(t,e)},off:function(t){return this.events.off(t)},trigger:function(t){return this.events.triggerHandler(t)},defaults:{placeholder:"",sortStart:function(){},sortEnd:function(){}}},n.fn.lightSortable=function(e){var i=Array.prototype.slice.call(arguments,1);return this.each(function(){var t;void 0===n(this).data("lightSortable")?(t=new a(this,e),n(this).data("lightSortable",t)):void 0!==e&&("function"==typeof(t=n(this).data("lightSortable"))[e]?t[e].apply(t,i):n.error(e+" does not exist in lightSortable."))})}}(jQuery),function(e){e.lightURLParse=function(t){var t=t.split("?")[1].split("&"),i=[];return e.each(t,function(t,e){e=e.split("=");i[e[0]]=e[1]}),i}}(jQuery),function(n){function a(t,e={}){this.options=e,this.$textarea=n(t),this.isCodeMirror=!1,this.codeMirror=null,this.init()}a.prototype={init:function(){var t,e=this;this.settings=n.extend({},this.defaults,this.options),void 0!==wp.codeEditor.initialize?(t=wp.codeEditor.initialize(this.$textarea,this.setting),this.codeMirror=t.codemirror,this.isCodeMirror=!0,this.codeMirror.on("change",function(){e.trigger({type:"edit",value:e.codeMirror.getValue()})})):this.$textarea.on("input",function(){e.trigger({type:"edit",value:e.$textarea.val()})})},getValue:function(){return!0===this.isCodeMirror?this.codeMirror.getValue():this.$textarea.val()},on:function(t,e){return this.$textarea.on(t,e)},off:function(t){return this.$textarea.off(t)},trigger:function(t){return this.$textarea.triggerHandler(t)},refresh:function(){!0===this.isCodeMirror&&this.codeMirror.refresh()},destroy:function(){this.$textarea.removeData("codeEditor"),!0===this.isCodeMirror?(this.codeMirror.toTextArea(),this.codeMirror.off("change")):this.$textarea.off("input")},defaults:{}},n.fn.codeEditor=function(e){var i=Array.prototype.slice.call(arguments,1);return this.each(function(){var t;void 0===n(this).data("codeEditor")?(t=new a(this,e),n(this).data("codeEditor",t)):void 0!==e&&("function"==typeof(t=n(this).data("codeEditor"))[e]?t[e].apply(t,i):n.error(e+" does not exist in codeEditor."))})}}(jQuery);